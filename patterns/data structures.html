<!DOCTYPE html>
<html lang="en"><head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Patterns Data Structures | Dmitry Babichev’s webpage</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Patterns Data Structures" />
<meta name="author" content="Dmitry Babichev" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Here you can find solution to some algorithmic problems, at the moment it is mainly leetcode problems." />
<meta property="og:description" content="Here you can find solution to some algorithmic problems, at the moment it is mainly leetcode problems." />
<meta property="og:site_name" content="Dmitry Babichev’s webpage" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Patterns Data Structures" />
<script type="application/ld+json">
{"url":"/patterns/data%20structures","@type":"WebPage","headline":"Patterns Data Structures","author":{"@type":"Person","name":"Dmitry Babichev"},"description":"Here you can find solution to some algorithmic problems, at the moment it is mainly leetcode problems.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Dmitry Babichev's webpage" />
    






  



<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

</head>

    
    <!-- for mathjax support -->
    
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Dmitry Babichev&#39;s webpage</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/codeforces%20problems/">Codeforces</a><a class="page-link" href="/leetcode/">Leetcode</a><a class="page-link" href="/binarysearch%20problems/">BinarySearch</a><a class="page-link" href="/coding%20ideas/">Patterns</a><a class="page-link" href="/performance%20tricks/">Speed up</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Patterns Data Structures</h1>
  </header>

  <div class="post-content">
    <p>Here is a collection of different data structures patterns.</p>

<h4 id="bit-array">Bit array</h4>
<p>Implements bitarray using bytearray. If you have a lot of 0/1 data that there is very compact way to keep it it in bitarray, which will take <code class="language-plaintext highlighter-rouge">8</code> less space than <code class="language-plaintext highlighter-rouge">bytearray</code> and <code class="language-plaintext highlighter-rouge">32</code> times less than list of integers.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">BitArray</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="nb">bytes</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">((</span><span class="n">size</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="nb">bytes</span><span class="p">[</span><span class="n">index</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">index</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="nb">bytes</span><span class="p">[</span><span class="n">index</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">]</span> <span class="o">|=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">index</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="nb">bytes</span><span class="p">[</span><span class="n">index</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">index</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">))</span>
</code></pre></div></div>

<h4 id="binary-indexed-tree">Binary indexed tree</h4>
<p>This data structure is less flexible than segment trees, but much more easier to code. Here is implemenation to have queries of sums of numbers in the form <code class="language-plaintext highlighter-rouge">[0, i]</code>, also it is easy to do ranges <code class="language-plaintext highlighter-rouge">[i, j]</code>. We can choose another function (which what properties?), such that we only can answer <code class="language-plaintext highlighter-rouge">[0, i]</code> queries, for example to evaluate <code class="language-plaintext highlighter-rouge">max</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">BIT</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sums</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">delta</span><span class="p">):</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">sums</span><span class="p">):</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">sums</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">delta</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="n">i</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">-</span><span class="n">i</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sums</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">i</span> <span class="o">-=</span> <span class="n">i</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">-</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<h5 id="advanced-version">advanced version.</h5>
<ol>
  <li><code class="language-plaintext highlighter-rouge">__init__(self, x)</code> will transform list <code class="language-plaintext highlighter-rouge">x</code> to BIT in <code class="language-plaintext highlighter-rouge">O(n)</code> time.</li>
  <li><code class="language-plaintext highlighter-rouge">update(self, idx, x)</code> will update <code class="language-plaintext highlighter-rouge">bit[idx] += x</code> in <code class="language-plaintext highlighter-rouge">O(log n)</code> time.</li>
  <li><code class="language-plaintext highlighter-rouge">query(self, i)</code> will calculate <code class="language-plaintext highlighter-rouge">sum(bit[:i])</code>, be careful here, <code class="language-plaintext highlighter-rouge">i</code> is not included in <code class="language-plaintext highlighter-rouge">O(log n)</code> time</li>
  <li><code class="language-plaintext highlighter-rouge">findkth(self, k)</code> find largest <code class="language-plaintext highlighter-rouge">idx</code> such that <code class="language-plaintext highlighter-rouge">sum(bit[:idx]) &lt;= k</code> in `O(log^2 n) time).</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">BIT</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">bit</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">|</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">while</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">bit</span><span class="p">):</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">bit</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x</span>
            <span class="n">idx</span> <span class="o">|=</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="p">.</span><span class="n">bit</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">i</span> <span class="o">&amp;=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="k">def</span> <span class="nf">findkth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">bit</span><span class="p">).</span><span class="n">bit_length</span><span class="p">())):</span>
            <span class="n">right_idx</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">d</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">right_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">bit</span><span class="p">)</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="p">.</span><span class="n">bit</span><span class="p">[</span><span class="n">right_idx</span><span class="p">]:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">right_idx</span>
                <span class="n">k</span> <span class="o">-=</span> <span class="bp">self</span><span class="p">.</span><span class="n">bit</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div></div>

<h4 id="fractions">Fractions</h4>
<p>In python there is library which works with fractions already, but is quite slow. If you want faster implementation, here it is.</p>

<p>Also, there is <code class="language-plaintext highlighter-rouge">limit_denominator(frac, max_den)</code> function, which is given fraction and maximum denominator, will find the closest fraction with denominator which is less or equal to maximum denominator. Complexity I think is logarithmic.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Fraction</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">gcd</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">den</span> <span class="o">=</span> <span class="n">num</span> <span class="o">//</span> <span class="n">g</span><span class="p">,</span> <span class="n">den</span> <span class="o">//</span> <span class="n">g</span>

    <span class="n">__add__</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Fraction</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">num</span> <span class="o">*</span> <span class="n">other</span><span class="p">.</span><span class="n">den</span> <span class="o">+</span> <span class="n">other</span><span class="p">.</span><span class="n">num</span> <span class="o">*</span> <span class="bp">self</span><span class="p">.</span><span class="n">den</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">den</span> <span class="o">*</span> <span class="n">other</span><span class="p">.</span><span class="n">den</span><span class="p">)</span>
    <span class="n">__sub__</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Fraction</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">num</span> <span class="o">*</span> <span class="n">other</span><span class="p">.</span><span class="n">den</span> <span class="o">-</span> <span class="n">other</span><span class="p">.</span><span class="n">num</span> <span class="o">*</span> <span class="bp">self</span><span class="p">.</span><span class="n">den</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">den</span> <span class="o">*</span> <span class="n">other</span><span class="p">.</span><span class="n">den</span><span class="p">)</span>
    <span class="n">__mul__</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Fraction</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">num</span> <span class="o">*</span> <span class="n">other</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">den</span> <span class="o">*</span> <span class="n">other</span><span class="p">.</span><span class="n">den</span><span class="p">)</span>
    <span class="n">__truediv__</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Fraction</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">num</span> <span class="o">*</span> <span class="n">other</span><span class="p">.</span><span class="n">den</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">den</span> <span class="o">*</span> <span class="n">other</span><span class="p">.</span><span class="n">num</span><span class="p">)</span>
    <span class="n">__floordiv__</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">num</span> <span class="o">*</span> <span class="n">other</span><span class="p">.</span><span class="n">den</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">den</span> <span class="o">*</span> <span class="n">other</span><span class="p">.</span><span class="n">num</span><span class="p">)</span>

    <span class="n">__pow__</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Fraction</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">num</span><span class="o">**</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">den</span><span class="o">**</span><span class="n">other</span><span class="p">)</span>
    <span class="n">__abs__</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span> <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">num</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">Fraction</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">den</span><span class="p">)</span>
    <span class="n">__neg__</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="n">Fraction</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">den</span><span class="p">)</span>
    <span class="n">__round__</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">ndigits</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">num</span> <span class="o">/</span> <span class="bp">self</span><span class="p">.</span><span class="n">den</span><span class="p">,</span> <span class="n">ndigits</span><span class="p">)</span>

    <span class="n">__bool__</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">num</span><span class="p">)</span>
    <span class="n">__int__</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">num</span> <span class="o">//</span> <span class="bp">self</span><span class="p">.</span><span class="n">den</span>
    <span class="n">__float__</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">num</span> <span class="o">/</span> <span class="bp">self</span><span class="p">.</span><span class="n">den</span>
    <span class="n">__str__</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="s">"({}, {})"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">den</span><span class="p">)</span>

    <span class="n">__copy__</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="n">Fraction</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">den</span><span class="p">)</span>
    <span class="n">__hash__</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="nb">hash</span><span class="p">((</span><span class="bp">self</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">den</span><span class="p">))</span>

    <span class="n">__eq__</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">num</span> <span class="o">*</span> <span class="n">other</span><span class="p">.</span><span class="n">den</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">num</span> <span class="o">*</span> <span class="bp">self</span><span class="p">.</span><span class="n">den</span>
    <span class="n">__ne__</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">num</span> <span class="o">*</span> <span class="n">other</span><span class="p">.</span><span class="n">den</span> <span class="o">!=</span> <span class="n">other</span><span class="p">.</span><span class="n">num</span> <span class="o">*</span> <span class="bp">self</span><span class="p">.</span><span class="n">den</span>
    <span class="n">__lt__</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">num</span> <span class="o">*</span> <span class="n">other</span><span class="p">.</span><span class="n">den</span> <span class="o">&lt;</span> <span class="n">other</span><span class="p">.</span><span class="n">num</span> <span class="o">*</span> <span class="bp">self</span><span class="p">.</span><span class="n">den</span>
    <span class="n">__gt__</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">num</span> <span class="o">*</span> <span class="n">other</span><span class="p">.</span><span class="n">den</span> <span class="o">&gt;</span> <span class="n">other</span><span class="p">.</span><span class="n">num</span> <span class="o">*</span> <span class="bp">self</span><span class="p">.</span><span class="n">den</span>
    <span class="n">__le__</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">num</span> <span class="o">*</span> <span class="n">other</span><span class="p">.</span><span class="n">den</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="p">.</span><span class="n">num</span> <span class="o">*</span> <span class="bp">self</span><span class="p">.</span><span class="n">den</span>
    <span class="n">__ge__</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">num</span> <span class="o">*</span> <span class="n">other</span><span class="p">.</span><span class="n">den</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="p">.</span><span class="n">num</span> <span class="o">*</span> <span class="bp">self</span><span class="p">.</span><span class="n">den</span>

    <span class="n">__repr__</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="s">"Fraction({}, {})"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">den</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">limit_denominator</span><span class="p">(</span><span class="n">frac</span><span class="p">,</span> <span class="n">max_den</span><span class="o">=</span><span class="mi">1000000</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">frac</span><span class="p">.</span><span class="n">den</span> <span class="o">&lt;=</span> <span class="n">max_den</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">frac</span>

    <span class="n">p0</span><span class="p">,</span> <span class="n">q0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">q1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">frac</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="n">frac</span><span class="p">.</span><span class="n">den</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="n">d</span>
        <span class="n">q2</span> <span class="o">=</span> <span class="n">q0</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">q1</span>
        <span class="k">if</span> <span class="n">q2</span> <span class="o">&gt;</span> <span class="n">max_den</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">p0</span><span class="p">,</span> <span class="n">q0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">q1</span> <span class="o">=</span> <span class="n">p1</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">p0</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">p1</span><span class="p">,</span> <span class="n">q2</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">d</span>

    <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_den</span> <span class="o">-</span> <span class="n">q0</span><span class="p">)</span> <span class="o">//</span> <span class="n">q1</span>
    <span class="n">bound1</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">p0</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">p1</span><span class="p">,</span> <span class="n">q0</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">q1</span><span class="p">)</span>
    <span class="n">bound2</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">q1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bound2</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">bound2</span> <span class="o">-</span> <span class="n">frac</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">bound1</span> <span class="o">-</span> <span class="n">frac</span><span class="p">)</span> <span class="k">else</span> <span class="n">bound1</span>
</code></pre></div></div>

<h4 id="continuous-fractions">Continuous fractions</h4>
<ol>
  <li><code class="language-plaintext highlighter-rouge">CFraction(frac)</code> transforms usual franction to continuous fraction, e.g. <code class="language-plaintext highlighter-rouge">123/32 -&gt; 3, 1, 5, 2, 2</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">CFrac2Frac(cfrac)</code> transforms in the opposite direction.</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">CFraction</span><span class="p">(</span><span class="n">frac</span><span class="p">):</span>
    <span class="n">num</span><span class="p">,</span> <span class="n">den</span> <span class="o">=</span> <span class="n">frac</span>
    <span class="k">yield</span> <span class="n">num</span> <span class="o">//</span> <span class="n">den</span>
    <span class="n">num</span> <span class="o">%=</span> <span class="n">den</span>
    <span class="k">while</span> <span class="n">den</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">num</span><span class="p">,</span> <span class="n">den</span> <span class="o">=</span> <span class="n">den</span><span class="p">,</span> <span class="n">num</span>
        <span class="k">yield</span> <span class="n">num</span> <span class="o">//</span> <span class="n">den</span>
        <span class="n">num</span> <span class="o">%=</span> <span class="n">den</span>

<span class="k">def</span> <span class="nf">CFrac2Frac</span><span class="p">(</span><span class="n">cfrac</span><span class="p">):</span>
    <span class="n">num</span><span class="p">,</span> <span class="n">den</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">cfrac</span><span class="p">):</span>
        <span class="n">num</span><span class="p">,</span> <span class="n">den</span> <span class="o">=</span> <span class="n">den</span> <span class="o">+</span> <span class="n">num</span> <span class="o">*</span> <span class="n">u</span><span class="p">,</span> <span class="n">num</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="union-find">Union find</h4>

<h5 id="version-1">Version 1</h5>

<p>Note, that <code class="language-plaintext highlighter-rouge">self.p</code> is <strong>not</strong> values of set for each node, but pointer to parent.</p>

<p>Without ranks implementation but with path compression. It has potentially $O(n)$ time complexity, but in practice, if data is not meant to broke it will work like $O(\log n)$ in average.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DSU</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">p</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">!=</span> <span class="n">x</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">union</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">xr</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">yr</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">p</span><span class="p">[</span><span class="n">xr</span><span class="p">]</span> <span class="o">=</span> <span class="n">yr</span>
</code></pre></div></div>

<h5 id="version-2">Version 2</h5>
<p>If previous implementation is not enough, there is implementation with ranks and with path compressions, which will be $O(\mathcal{A}(n))$ complexity, where $\mathcal{A}(n)$ is inverse Ackermann funcion, which in fact grows so slow, that we can state that complexity is $O(1)$. Actually path compressions will make code just one line longer.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DSU</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">par</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">rnk</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">N</span>

    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">par</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">!=</span> <span class="n">x</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">par</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">par</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">par</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">union</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">xr</span><span class="p">,</span> <span class="n">yr</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xr</span> <span class="o">==</span> <span class="n">yr</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="p">.</span><span class="n">rnk</span><span class="p">[</span><span class="n">xr</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="p">.</span><span class="n">rnk</span><span class="p">[</span><span class="n">yr</span><span class="p">]:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">par</span><span class="p">[</span><span class="n">xr</span><span class="p">]</span> <span class="o">=</span> <span class="n">yr</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="p">.</span><span class="n">rnk</span><span class="p">[</span><span class="n">xr</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="p">.</span><span class="n">rnk</span><span class="p">[</span><span class="n">yr</span><span class="p">]:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">par</span><span class="p">[</span><span class="n">yr</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">par</span><span class="p">[</span><span class="n">yr</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">rnk</span><span class="p">[</span><span class="n">xr</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">True</span>
</code></pre></div></div>

<h5 id="version-3">Version 3</h5>
<p>If you need a bit more functionality, use this version: here we have also have size of each set (however we do not have ranks) and we have total number of sets.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DisjointSetUnion</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">num_sets</span> <span class="o">=</span> <span class="n">n</span>

    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="n">acopy</span> <span class="o">=</span> <span class="n">a</span>
        <span class="k">while</span> <span class="n">a</span> <span class="o">!=</span> <span class="bp">self</span><span class="p">.</span><span class="n">parent</span><span class="p">[</span><span class="n">a</span><span class="p">]:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">parent</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
        <span class="k">while</span> <span class="n">acopy</span> <span class="o">!=</span> <span class="n">a</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">parent</span><span class="p">[</span><span class="n">acopy</span><span class="p">],</span> <span class="n">acopy</span> <span class="o">=</span> <span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">parent</span><span class="p">[</span><span class="n">acopy</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">a</span>

    <span class="k">def</span> <span class="nf">union</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="bp">self</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">b</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">size</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="p">.</span><span class="n">size</span><span class="p">[</span><span class="n">b</span><span class="p">]:</span>
                <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span>

            <span class="bp">self</span><span class="p">.</span><span class="n">num_sets</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">parent</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">size</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="p">.</span><span class="n">size</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">set_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">size</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">num_sets</span>
</code></pre></div></div>

<h4 id="linked-list">Linked list</h4>
<p><code class="language-plaintext highlighter-rouge">Node</code> is just definition for double linked list node. Now, let us discuss <code class="language-plaintext highlighter-rouge">LinkedList</code> functions:</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">__init__</code> is just initialize empty double linked list, which is looped: that is last node connected to the first. Sentinel node do not have value and have <code class="language-plaintext highlighter-rouge">None</code> inside.</li>
  <li><code class="language-plaintext highlighter-rouge">get_node(self, index)</code> will return node given <code class="language-plaintext highlighter-rouge">index</code>. Also if we reached the end it will return <code class="language-plaintext highlighter-rouge">None</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">__getitem__(self, index)</code> will return value of node given index.</li>
  <li><code class="language-plaintext highlighter-rouge">__len__(self)</code> is length of our linked list.</li>
  <li><code class="language-plaintext highlighter-rouge">__setitem__(self, index, value)</code> will update node at <code class="language-plaintext highlighter-rouge">index</code> with new <code class="language-plaintext highlighter-rouge">value</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">__delitem__(self, index)</code> will delete node in given index if it is possible.</li>
  <li><code class="language-plaintext highlighter-rouge">__repr__(self)</code> is to show what is inside our list.</li>
  <li><code class="language-plaintext highlighter-rouge">to_list(self)</code> is to transform our linked list to usual list.</li>
  <li><code class="language-plaintext highlighter-rouge">append(self, value)</code> is to append new node to the end.</li>
  <li><code class="language-plaintext highlighter-rouge">appendleft(self, value)</code> is to append new node to the start.</li>
  <li><code class="language-plaintext highlighter-rouge">insert(self, index, value)</code> is to insert new value at given index.</li>
  <li><code class="language-plaintext highlighter-rouge">insert_between(self, node, left_node, right_node)</code> is to insert new node between two nodes.</li>
  <li><code class="language-plaintext highlighter-rouge">insert_after(self, node, value)</code> is to insert node after given node. Different with <code class="language-plaintext highlighter-rouge">insert</code> is that here we have node, not index.</li>
  <li><code class="language-plaintext highlighter-rouge">merge_left(self, other)</code> is to concatenate new list to the left of the current list.</li>
  <li><code class="language-plaintext highlighter-rouge">merge_right(self, other)</code>, similar but from the right.</li>
  <li><code class="language-plaintext highlighter-rouge">pop(self, node = None)</code> is to delete node if possible and return its value.</li>
  <li><code class="language-plaintext highlighter-rouge">before</code> is return node before if possible, if not, return cycle shift.</li>
  <li>`after is to return node after node if possible and if not, return cycle shift.</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="p">.</span><span class="nb">next</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">prev</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"{}()"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">"{}({})"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">LinkedList</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span><span class="p">.</span><span class="nb">next</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span><span class="p">.</span><span class="n">prev</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">__len</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">iterable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span> <span class="o">+=</span> <span class="n">iterable</span>

    <span class="k">def</span> <span class="nf">get_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">index</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="nb">next</span>
            <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">node</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node</span><span class="p">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__len</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="n">node</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">node</span><span class="p">:</span>
            <span class="n">node</span><span class="p">.</span><span class="n">prev</span><span class="p">.</span><span class="nb">next</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="nb">next</span>
            <span class="k">if</span> <span class="n">node</span><span class="p">.</span><span class="nb">next</span><span class="p">:</span>
                <span class="n">node</span><span class="p">.</span><span class="nb">next</span><span class="p">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">prev</span>
            <span class="n">node</span><span class="p">.</span><span class="n">prev</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">node</span><span class="p">.</span><span class="nb">next</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">node</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">__len</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">to_list</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">to_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">elts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">curr</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span><span class="p">.</span><span class="nb">next</span>
        <span class="k">while</span> <span class="n">curr</span> <span class="o">!=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span><span class="p">:</span>
            <span class="n">elts</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">curr</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">curr</span> <span class="o">=</span> <span class="n">curr</span><span class="p">.</span><span class="nb">next</span>
        <span class="k">return</span> <span class="n">elts</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">insert_between</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span><span class="p">.</span><span class="n">prev</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">appendleft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">insert_between</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span><span class="p">.</span><span class="nb">next</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">new_node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">len_</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">len_</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">insert_between</span><span class="p">(</span><span class="n">new_node</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">len_</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">insert_between</span><span class="p">(</span><span class="n">new_node</span><span class="p">,</span> <span class="n">node</span><span class="p">.</span><span class="n">prev</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="n">len_</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">insert_between</span><span class="p">(</span><span class="n">new_node</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span><span class="p">.</span><span class="n">prev</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">IndexError</span>

    <span class="k">def</span> <span class="nf">insert_between</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">left_node</span><span class="p">,</span> <span class="n">right_node</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span> <span class="ow">and</span> <span class="n">left_node</span> <span class="ow">and</span> <span class="n">right_node</span><span class="p">:</span>
            <span class="n">node</span><span class="p">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">left_node</span>
            <span class="n">node</span><span class="p">.</span><span class="nb">next</span> <span class="o">=</span> <span class="n">right_node</span>
            <span class="n">left_node</span><span class="p">.</span><span class="nb">next</span> <span class="o">=</span> <span class="n">node</span>
            <span class="n">right_node</span><span class="p">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">node</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">__len</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">IndexError</span>

    <span class="k">def</span> <span class="nf">insert_after</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">new_node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">node</span><span class="p">.</span><span class="nb">next</span><span class="p">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">new_node</span>
        <span class="n">new_node</span><span class="p">.</span><span class="nb">next</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="nb">next</span>
        <span class="n">node</span><span class="p">.</span><span class="nb">next</span> <span class="o">=</span> <span class="n">new_node</span>
        <span class="n">new_node</span><span class="p">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">node</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">__len</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">merge_left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span><span class="p">.</span><span class="nb">next</span><span class="p">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">other</span><span class="p">.</span><span class="n">sentinel</span><span class="p">.</span><span class="n">prev</span>
        <span class="n">other</span><span class="p">.</span><span class="n">sentinel</span><span class="p">.</span><span class="n">prev</span><span class="p">.</span><span class="nb">next</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span><span class="p">.</span><span class="nb">next</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span><span class="p">.</span><span class="nb">next</span> <span class="o">=</span> <span class="n">other</span><span class="p">.</span><span class="n">sentinel</span><span class="p">.</span><span class="nb">next</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span><span class="p">.</span><span class="nb">next</span><span class="p">.</span><span class="n">prev</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">__len</span> <span class="o">+=</span> <span class="n">other</span><span class="p">.</span><span class="n">__len</span>

    <span class="k">def</span> <span class="nf">merge_right</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span><span class="p">.</span><span class="n">prev</span><span class="p">.</span><span class="nb">next</span> <span class="o">=</span> <span class="n">other</span><span class="p">.</span><span class="n">sentinel</span><span class="p">.</span><span class="nb">next</span>
        <span class="n">other</span><span class="p">.</span><span class="n">sentinel</span><span class="p">.</span><span class="nb">next</span><span class="p">.</span><span class="n">prev</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span><span class="p">.</span><span class="n">prev</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span><span class="p">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">other</span><span class="p">.</span><span class="n">sentinel</span><span class="p">.</span><span class="n">prev</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span><span class="p">.</span><span class="n">prev</span><span class="p">.</span><span class="nb">next</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">__len</span> <span class="o">+=</span> <span class="n">other</span><span class="p">.</span><span class="n">__len</span>

    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span><span class="p">.</span><span class="n">prev</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">__len</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">IndexError</span>
        <span class="n">node</span><span class="p">.</span><span class="n">prev</span><span class="p">.</span><span class="nb">next</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="nb">next</span>
        <span class="n">node</span><span class="p">.</span><span class="nb">next</span><span class="p">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">prev</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">__len</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">node</span><span class="p">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="nf">before</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span><span class="p">.</span><span class="n">prev</span> <span class="o">==</span> <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">node</span><span class="p">.</span><span class="n">prev</span><span class="p">.</span><span class="n">prev</span>
        <span class="k">return</span> <span class="n">node</span><span class="p">.</span><span class="n">prev</span>

    <span class="k">def</span> <span class="nf">after</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span><span class="p">.</span><span class="nb">next</span> <span class="o">==</span> <span class="bp">self</span><span class="p">.</span><span class="n">sentinel</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">node</span><span class="p">.</span><span class="nb">next</span><span class="p">.</span><span class="nb">next</span>
        <span class="k">return</span> <span class="n">node</span><span class="p">.</span><span class="nb">next</span>
</code></pre></div></div>

<h4 id="sparse-table">Sparse table</h4>
<p>It is used to answer queries on range in <code class="language-plaintext highlighter-rouge">O(1)</code> given function <code class="language-plaintext highlighter-rouge">min, max</code> or another function such that <code class="language-plaintext highlighter-rouge">f(x, x) = x</code>. Time of construction is <code class="language-plaintext highlighter-rouge">O(n log n)</code>, time of query is <code class="language-plaintext highlighter-rouge">O(1)</code>.</p>

<p>Notice, that Minimum Range Query problem can be solved in different ways, the best init/range complexity is <code class="language-plaintext highlighter-rouge">O(n)/O(1)</code>, but it is quite difficult to code (<strong>ADD TEMPLATE</strong>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RangeQuery</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="nb">min</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">_data</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)]</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">while</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">:</span>
            <span class="n">prev</span> <span class="o">=</span> <span class="n">_data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">_data</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="n">func</span><span class="p">(</span><span class="n">prev</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">prev</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
            <span class="n">i</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">):</span>
        <span class="s">"""func of data[start, stop)"""</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">).</span><span class="n">bit_length</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">_data</span><span class="p">[</span><span class="n">depth</span><span class="p">][</span><span class="n">start</span><span class="p">],</span> <span class="bp">self</span><span class="p">.</span><span class="n">_data</span><span class="p">[</span><span class="n">depth</span><span class="p">][</span><span class="n">stop</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">depth</span><span class="p">)])</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
</code></pre></div></div>

<h4 id="segment-tree-with-lazy-updates">Segment Tree with lazy updates</h4>
<p>There are different versions of segment trees with different funcionality.</p>

<h5 id="version-1-1">Version 1</h5>
<p>Here is universal Segment Tree with $O(\log n)$ complexities of each operation. What we need here is to be able to have the following data structure. Given numbers $x_1,\dots, x_n$, we want:</p>
<ol>
  <li>Find maximum (or another function <code class="language-plaintext highlighter-rouge">query_fn</code>, properties will be discussed later) on range <code class="language-plaintext highlighter-rouge">[l, r]</code>, this is query(self, v, tl, tr, l, r) and we want to do it in $O(\log n)$ complexity. We need to run it with arguments <code class="language-plaintext highlighter-rouge">(1, 0, n-1, l, r)</code> to get answer on range <code class="language-plaintext highlighter-rouge">[l, r]</code>. Here <code class="language-plaintext highlighter-rouge">v</code> is index of segment, <code class="language-plaintext highlighter-rouge">1</code> corresponds to range <code class="language-plaintext highlighter-rouge">[0, n-1]</code> and each segment have two children with indexes <code class="language-plaintext highlighter-rouge">2*v</code> and <code class="language-plaintext highlighter-rouge">2*v+1</code>, that is why we start indexing with <code class="language-plaintext highlighter-rouge">1</code>, not <code class="language-plaintext highlighter-rouge">0</code>.</li>
  <li>Update values for whole range <code class="language-plaintext highlighter-rouge">[l, r]</code>, using function <code class="language-plaintext highlighter-rouge">update_fn</code>. Note, that it is more difficult, that just to update one value, and we need to use so-called lazy updates. This is function <code class="language-plaintext highlighter-rouge">update(self, v, tl, tr, l, r, h)</code> We need to run it with arguments <code class="language-plaintext highlighter-rouge">(1, 0, n-1, l, r, h)</code>. Time complexity is also $O(\log n)$.</li>
</ol>

<p>Now, let us discuss possible choices of query and update functions. Denote <code class="language-plaintext highlighter-rouge">update_fn</code> by $\otimes$ and <code class="language-plaintext highlighter-rouge">query_fn</code> by $\oplus$, then they should have the following properties:</p>
<ol>
  <li>We have semigroup for binary operation $\oplus$: $(a\oplus b)\oplus c = a\oplus (b\oplus c); $</li>
  <li>We have monoid for binary operation $\otimes$:  $(a\otimes b)\otimes c = a\otimes (b\otimes c)$, $a\otimes e = e\otimes a = a$</li>
  <li>$\otimes$ is right-distributive over $\oplus$: $(a\otimes c)\oplus (b\otimes c) = (a\oplus b) \otimes c$</li>
</ol>

<p>Note also, that we can easily create so-called sparse segment tree: instead of list with zeroes, we can keep dictionary. Then space complexity for whole tree will be $O(k\log N)$ instead of $O(N)$, where $k$ is number of elements in tree.</p>

<p>Here is iterative version, which in practice works 1.5-2 times faster than recursive. <strong>Be carefull with zero elements</strong>, they will change depending on <code class="language-plaintext highlighter-rouge">update_fn</code> and <code class="language-plaintext highlighter-rouge">query_fn</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">SegmentTree</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">update_fn</span><span class="p">,</span> <span class="n">query_fn</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">N</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">H</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="bp">self</span><span class="p">.</span><span class="n">H</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">H</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">update_fn</span> <span class="o">=</span> <span class="n">update_fn</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">query_fn</span> <span class="o">=</span> <span class="n">query_fn</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">tree</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">N</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">lazy</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">N</span>

    <span class="k">def</span> <span class="nf">_apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">tree</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">update_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">tree</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="p">.</span><span class="n">N</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">lazy</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">update_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">lazy</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pull</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">while</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">/=</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">tree</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">query_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">tree</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="p">.</span><span class="n">tree</span><span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">tree</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">update_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">tree</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="bp">self</span><span class="p">.</span><span class="n">lazy</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">H</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="n">h</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">lazy</span><span class="p">[</span><span class="n">y</span><span class="p">]:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_apply</span><span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">lazy</span><span class="p">[</span><span class="n">y</span><span class="p">])</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_apply</span><span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="mi">2</span><span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">lazy</span><span class="p">[</span><span class="n">y</span><span class="p">])</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">lazy</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="n">L</span> <span class="o">+=</span> <span class="bp">self</span><span class="p">.</span><span class="n">N</span>
        <span class="n">R</span> <span class="o">+=</span> <span class="bp">self</span><span class="p">.</span><span class="n">N</span>
        <span class="n">L0</span><span class="p">,</span> <span class="n">R0</span> <span class="o">=</span> <span class="n">L</span><span class="p">,</span> <span class="n">R</span>
        <span class="k">while</span> <span class="n">L</span> <span class="o">&lt;=</span> <span class="n">R</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">L</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_apply</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
                <span class="n">L</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">R</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_apply</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
                <span class="n">R</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">L</span> <span class="o">/=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">R</span> <span class="o">/=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_pull</span><span class="p">(</span><span class="n">L0</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_pull</span><span class="p">(</span><span class="n">R0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">R</span><span class="p">):</span>
        <span class="n">L</span> <span class="o">+=</span> <span class="bp">self</span><span class="p">.</span><span class="n">N</span>
        <span class="n">R</span> <span class="o">+=</span> <span class="bp">self</span><span class="p">.</span><span class="n">N</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_push</span><span class="p">(</span><span class="n">L</span><span class="p">);</span> <span class="bp">self</span><span class="p">.</span><span class="n">_push</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">L</span> <span class="o">&lt;=</span> <span class="n">R</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">L</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ans</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">query_fn</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">tree</span><span class="p">[</span><span class="n">L</span><span class="p">])</span>
                <span class="n">L</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">R</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ans</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">query_fn</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">tree</span><span class="p">[</span><span class="n">R</span><span class="p">])</span>
                <span class="n">R</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">L</span> <span class="o">/=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">R</span> <span class="o">/=</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="n">ans</span>
</code></pre></div></div>

<h5 id="version-2-1">Version 2</h5>
<p>It is recursive version of previous algorithm. Again be carefull with zero elements.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">SegmentTree</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">update_fn</span><span class="p">,</span> <span class="n">query_fn</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">UF</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">QF</span> <span class="o">=</span> <span class="n">update_fn</span><span class="p">,</span> <span class="n">query_fn</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>   <span class="c1"># [0] * (4*N)
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>   <span class="c1"># [0] * (4*N)
</span>    
    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">v</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">T</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">UF</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">T</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="bp">self</span><span class="p">.</span><span class="n">L</span><span class="p">[</span><span class="n">v</span><span class="p">])</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">L</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">UF</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">L</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="bp">self</span><span class="p">.</span><span class="n">L</span><span class="p">[</span><span class="n">v</span><span class="p">])</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">L</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">tl</span><span class="p">,</span> <span class="n">tr</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="n">r</span><span class="p">:</span> <span class="k">return</span>
        <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="n">tl</span> <span class="ow">and</span> <span class="n">r</span> <span class="o">==</span> <span class="n">tr</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">T</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">UF</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">T</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="n">h</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">L</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">UF</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">L</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="n">h</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="n">tm</span> <span class="o">=</span> <span class="p">(</span><span class="n">tl</span> <span class="o">+</span> <span class="n">tr</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">tl</span><span class="p">,</span> <span class="n">tm</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">tm</span><span class="p">),</span> <span class="n">h</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">tr</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">r</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">T</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">QF</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">T</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="p">.</span><span class="n">T</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">tl</span><span class="p">,</span> <span class="n">tr</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="n">r</span><span class="p">:</span> <span class="k">return</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s">"inf"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">l</span> <span class="o">&lt;=</span> <span class="n">tl</span> <span class="ow">and</span> <span class="n">tr</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">T</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">tm</span> <span class="o">=</span> <span class="p">(</span><span class="n">tl</span> <span class="o">+</span> <span class="n">tr</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">QF</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">tl</span><span class="p">,</span> <span class="n">tm</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">tm</span><span class="p">)),</span> <span class="bp">self</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">tr</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">r</span><span class="p">))</span>
</code></pre></div></div>

<h5 id="version-3-1">Version 3</h5>
<p>Here is lighter version, which works faster, but without range updates.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">SegmentTree</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_fn</span><span class="p">,</span> <span class="n">query_fn</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">UF</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">QF</span> <span class="o">=</span> <span class="n">update_fn</span><span class="p">,</span> <span class="n">query_fn</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">tl</span><span class="p">,</span> <span class="n">tr</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tl</span> <span class="o">==</span> <span class="n">tr</span><span class="p">:</span> 
            <span class="bp">self</span><span class="p">.</span><span class="n">T</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">UF</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">T</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="n">h</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tm</span> <span class="o">=</span> <span class="p">(</span><span class="n">tl</span> <span class="o">+</span> <span class="n">tr</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
            <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;=</span> <span class="n">tm</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">tl</span><span class="p">,</span> <span class="n">tm</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">tr</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">T</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">QF</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">T</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="p">.</span><span class="n">T</span><span class="p">[</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">tl</span><span class="p">,</span> <span class="n">tr</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="n">r</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="n">tl</span> <span class="ow">and</span> <span class="n">r</span> <span class="o">==</span> <span class="n">tr</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">T</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
        <span class="n">tm</span> <span class="o">=</span> <span class="p">(</span><span class="n">tl</span> <span class="o">+</span> <span class="n">tr</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">QF</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">tl</span><span class="p">,</span> <span class="n">tm</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">tm</span><span class="p">)),</span> <span class="bp">self</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">tr</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">tm</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">r</span><span class="p">))</span>
</code></pre></div></div>

<h4 id="persistent-segment-tree">Persistent Segment Tree</h4>
<p>I think it is quite rare: see for code <a href="https://github.com/cheran-senthil/PyRival/blob/master/pyrival/data_structures/PersistentSegTree.py"> <font color="blue">https://github.com/cheran-senthil/PyRival/blob/master/pyrival/data_structures/PersistentSegTree.py/</font></a></p>

<p>The idea of this tree that it keeps changes.</p>

<h4 id="sorted-list">Sorted List</h4>
<p>If it is allowed to import it, just import. If not, copy code from <a href="https://github.com/cheran-senthil/PyRival/blob/master/pyrival/data_structures/SortedList.py"> <font color="blue">https://github.com/cheran-senthil/PyRival/blob/master/pyrival/data_structures/SortedList.py</font></a></p>

<h4 id="treap">Treap</h4>
<p>Another data structure with the same complexities as SortedList, check <a href="https://github.com/cheran-senthil/PyRival/blob/master/pyrival/data_structures/Treap.py "> <font color="blue">https://github.com/cheran-senthil/PyRival/blob/master/pyrival/data_structures/Treap.py</font></a></p>

<h4 id="trie">Trie</h4>

<h5 id="version-1-2">Version 1</h5>
<p>Here is implementation of trie, it is not the shortest one, but in this way you can modify it easily if needed. Here function <code class="language-plaintext highlighter-rouge">search(word)</code> will check if we have given <code class="language-plaintext highlighter-rouge">word</code> in our trie and <code class="language-plaintext highlighter-rouge">startsWith(prefix)</code> will check if we have words starting with prefix.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">TrieNode</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">end_node</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">class</span> <span class="nc">Trie</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">TrieNode</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span> <span class="c1">#None
</span>        <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">root</span>
        <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">root</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">TrieNode</span><span class="p">())</span>
        <span class="n">root</span><span class="p">.</span><span class="n">end_node</span> <span class="o">=</span> <span class="mi">1</span>
        
    <span class="k">def</span> <span class="nf">searchHelper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
        <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">root</span>
        <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">root</span><span class="p">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">root</span> <span class="o">=</span> <span class="n">root</span><span class="p">.</span><span class="n">children</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">root</span><span class="p">.</span><span class="n">end_node</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>  


    <span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span> <span class="c1">#bool:
</span>        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">searchHelper</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">startsWith</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span> <span class="c1">#bool:
</span>        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">searchHelper</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span>  
</code></pre></div></div>

<h5 id="version-2-2">Version 2</h5>
<p>Here is a bit different implementation, which potentially can be a bit faster. Sometimes it is useful for each node keep counter of how many times it is here, then functions add and delete will look more similar.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Trie</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">root</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
        <span class="n">current_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">root</span>
        <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
            <span class="n">current_dict</span> <span class="o">=</span> <span class="n">current_dict</span><span class="p">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">letter</span><span class="p">,</span> <span class="nb">dict</span><span class="p">())</span>
        <span class="n">current_dict</span><span class="p">[</span><span class="s">"_end_"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
        <span class="n">current_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">root</span>
        <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">letter</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current_dict</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="n">current_dict</span> <span class="o">=</span> <span class="n">current_dict</span><span class="p">[</span><span class="n">letter</span><span class="p">]</span>
        <span class="k">return</span> <span class="s">"_end_"</span> <span class="ow">in</span> <span class="n">current_dict</span>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
        <span class="n">current_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">root</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">current_dict</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
            <span class="n">current_dict</span> <span class="o">=</span> <span class="n">current_dict</span><span class="p">[</span><span class="n">letter</span><span class="p">]</span>
            <span class="n">nodes</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_dict</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">current_dict</span><span class="p">[</span><span class="s">"_end_"</span><span class="p">]</span>
</code></pre></div></div>

<p><strong>Remark:</strong> sometimes it is useful to keep frequency of each word as well, just add one more field to the first version.</p>

<h4 id="2sat">2SAT</h4>
<p>2SAT problem can be solved in linear time, using strong components. For more details look at https://github.com/cheran-senthil/PyRival/blob/master/pyrival/data_structures/TwoSat.py</p>

<h4 id="convex-hull-trick">Convex Hull Trick</h4>
<p>Given lines of form $f_i(x) = K_i \cdot x + M_i$, $i = 1,\dots, n$ the goal is to answer queries:</p>

\[\max\limits_{i=1}^n f_i(x) \ \ \ \ (1)\]

<p>for different given $x$.</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">clear_data(KM0)</code> will return cleaned set of lines: k coefficient will be in increasing order and also for lines with equal <code class="language-plaintext highlighter-rouge">k</code> only the line with the biggest <code class="language-plaintext highlighter-rouge">m</code> will be taken. Time complexity is $O(n \log n)$</li>
  <li><code class="language-plaintext highlighter-rouge">convex_hull_trick(KM)</code> will  return 
 <code class="language-plaintext highlighter-rouge">hull_i</code>: on interval <code class="language-plaintext highlighter-rouge">j</code>, line <code class="language-plaintext highlighter-rouge">i = hull_i[j]</code> is &gt;= all other lines;
     <code class="language-plaintext highlighter-rouge">hull_x</code>: interval <code class="language-plaintext highlighter-rouge">j</code> and <code class="language-plaintext highlighter-rouge">j + 1</code> is separated by <code class="language-plaintext highlighter-rouge">x = hull_x[j]</code>, (<code class="language-plaintext highlighter-rouge">hull_x[j]</code> is the last <code class="language-plaintext highlighter-rouge">x</code> in interval <code class="language-plaintext highlighter-rouge">j</code>)
Time complexity is $O(n)$.</li>
  <li><code class="language-plaintext highlighter-rouge">max_query(x)</code> will return value of equation $(1)$. Complexity is $O(\log n)$.</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">bisect</span> <span class="kn">import</span> <span class="n">bisect_left</span>

<span class="k">def</span> <span class="nf">clear_data</span><span class="p">(</span><span class="n">KM0</span><span class="p">):</span>
    <span class="n">KM0</span><span class="p">,</span> <span class="n">KM</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">KM0</span> <span class="o">+</span> <span class="p">[(</span><span class="nb">float</span><span class="p">(</span><span class="s">"inf"</span><span class="p">),</span> <span class="mi">0</span><span class="p">)]),</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">m1</span><span class="p">),</span> <span class="p">(</span><span class="n">k2</span><span class="p">,</span> <span class="n">m2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">KM0</span><span class="p">,</span> <span class="n">KM0</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="k">if</span> <span class="n">k1</span> <span class="o">&lt;</span> <span class="n">k2</span><span class="p">:</span> <span class="n">KM</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">k1</span><span class="p">,</span> <span class="n">m1</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">KM</span>

<span class="k">def</span> <span class="nf">convex_hull_trick</span><span class="p">(</span><span class="n">KM</span><span class="p">):</span>
    <span class="n">intersect</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="p">(</span><span class="n">KM</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">KM</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">KM</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">KM</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">hull_i</span><span class="p">,</span> <span class="n">hull_x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">KM</span><span class="p">)):</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">intersect</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">hull_i</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">hull_x</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">*</span> <span class="n">hull_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">hull_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">hull_i</span><span class="p">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">hull_x</span><span class="p">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="n">hull_i</span> <span class="o">+=</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">hull_x</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">hull_i</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="o">/</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">hull_x</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">max_query</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">hull_i</span><span class="p">[</span><span class="n">bisect_left</span><span class="p">(</span><span class="n">hull_x</span><span class="p">,</span> <span class="n">x</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">KM</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">KM</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

<span class="c1">#### Example
</span><span class="n">KM0</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
<span class="n">KM</span> <span class="o">=</span> <span class="n">clear_data</span><span class="p">(</span><span class="n">KM0</span><span class="p">)</span>
<span class="n">hull_i</span><span class="p">,</span> <span class="n">hull_x</span> <span class="o">=</span> <span class="n">convex_hull_trick</span><span class="p">(</span><span class="n">KM</span><span class="p">)</span>
<span class="n">max_query</span><span class="p">(</span><span class="mf">1.6</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Remark</strong>
I rewrote original algorithm a bit, so now it can work without roundind error: at least <code class="language-plaintext highlighter-rouge">hull_i</code> have correct order. <code class="language-plaintext highlighter-rouge">hull_x</code> can have some rounding errors and if we want to avoid floats at all, we need to write simple binary search by hands, where we compare fractions.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">Dmitry Babichev</li>
          <li><a class="u-email" href="mailto:dimitry008@gmail.com">dimitry008@gmail.com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>Here you can find solution to some algorithmic problems, at the moment it is mainly leetcode problems.
</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"></ul>
</div>

  </div>

</footer>
</body><script async src="https://www.googletagmanager.com/gtag/js?id=G-KR1GZKF62P"></script>
<script>
  window['ga-disable-G-KR1GZKF62P'] = window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1";
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-KR1GZKF62P');
</script>
</html>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>