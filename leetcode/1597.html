<!DOCTYPE html>
<html lang="en"><head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Leetcode 1597 Build Binary Expression Tree From Infix Expression | Dmitry Babichev’s webpage</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Leetcode 1597 Build Binary Expression Tree From Infix Expression" />
<meta name="author" content="Dmitry Babichev" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Problem statement" />
<meta property="og:description" content="Problem statement" />
<meta property="og:site_name" content="Dmitry Babichev’s webpage" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-01-31T14:30:22+03:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Leetcode 1597 Build Binary Expression Tree From Infix Expression" />
<script type="application/ld+json">
{"url":"/leetcode/1597.html","@type":"BlogPosting","headline":"Leetcode 1597 Build Binary Expression Tree From Infix Expression","dateModified":"2022-01-31T14:30:22+03:00","datePublished":"2022-01-31T14:30:22+03:00","mainEntityOfPage":{"@type":"WebPage","@id":"/leetcode/1597.html"},"author":{"@type":"Person","name":"Dmitry Babichev"},"description":"Problem statement","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Dmitry Babichev's webpage" />
    






  
  
</head>

    
    <!-- for mathjax support -->
    
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Dmitry Babichev&#39;s webpage</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/codeforces%20problems/">Codeforces</a><a class="page-link" href="/leetcode%20problems/">Leetcode</a><a class="page-link" href="/binarysearch%20problems/">BinarySearch</a><a class="page-link" href="/coding%20ideas/">Patterns</a><a class="page-link" href="/performance%20tricks/">Speed up</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <span>[
  
    
    <a href="/tag/string"><code class="highligher-rouge"><nobr>string</nobr></code>&nbsp;</a>
  
    
    <a href="/tag/parser"><code class="highligher-rouge"><nobr>parser</nobr></code>&nbsp;</a>
  
    
    <a href="/tag/recursion"><code class="highligher-rouge"><nobr>recursion</nobr></code>&nbsp;</a>
  
]</span>

<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Leetcode 1597 Build Binary Expression Tree From Infix Expression</h1>
    <p class="post-meta"><time class="dt-published" datetime="2022-01-31T14:30:22+03:00" itemprop="datePublished">
        Jan 31, 2022
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h4 id="problem-statement">Problem statement</h4>

<p><a href="https://leetcode.com/problems/build-binary-expression-tree-from-infix-expression/"> <font color="blue">https://leetcode.com/problems/build-binary-expression-tree-from-infix-expression/</font></a></p>

<h4 id="solution">Solution</h4>
<p>There is solution for this problem with stack with <code class="language-plaintext highlighter-rouge">O(n)</code> complexity, but it is a bit difficult to digest. I prefer alternative solution with <code class="language-plaintext highlighter-rouge">O(n log n)</code>, which I invented and it is easier to code and digest.</p>

<p>Define by <strong>level</strong> of symbol is how many pairs of brackets it is inside: that is when we have open bracket, level is increased by one and when we have closing bracket, it is decreased by one. We can calculate all levels of all operations <code class="language-plaintext highlighter-rouge">+-*/</code>. We will keep in <code class="language-plaintext highlighter-rouge">d[0][level]</code> all places for <code class="language-plaintext highlighter-rouge">+-</code> and in <code class="language-plaintext highlighter-rouge">d[0][level]</code> all places for <code class="language-plaintext highlighter-rouge">*/</code>.</p>

<p>Now, let us define recursive function <code class="language-plaintext highlighter-rouge">calc(beg, end, level)</code> which will construct tree of <code class="language-plaintext highlighter-rouge">s[beg:end+1]</code> and <code class="language-plaintext highlighter-rouge">level</code> is level of this string.</p>

<ol>
  <li>If <code class="language-plaintext highlighter-rouge">beg == end</code>, it means that we reached leaf, return it.</li>
  <li>If <code class="language-plaintext highlighter-rouge">beg &gt; end</code>, we return <code class="language-plaintext highlighter-rouge">None</code>, it can happen if we have case <code class="language-plaintext highlighter-rouge">()</code>, which is in fact empty expression.</li>
  <li>Next, we are going to find the rightest <code class="language-plaintext highlighter-rouge">+-</code> in our string with given <code class="language-plaintext highlighter-rouge">level</code>. Why? Because it will be the operation which we need to do first, that is the root of our tree. We recursively run <code class="language-plaintext highlighter-rouge">calc</code> for left and right parts of string and attach it to node. If we did not found <code class="language-plaintext highlighter-rouge">+-</code>, we will look for <code class="language-plaintext highlighter-rouge">*/</code> and do the same logic if we found it. Finally, if we did not found it as well, it means, that we have case <code class="language-plaintext highlighter-rouge">(...)</code> and we need to remove brackets and increase level.</li>
</ol>

<h4 id="complexity">Complexity</h4>
<p>Time complexity to build <code class="language-plaintext highlighter-rouge">d</code> is <code class="language-plaintext highlighter-rouge">O(n)</code>. However when we traverse tree, we do a lot of binary searches, in fact <code class="language-plaintext highlighter-rouge">O(n)</code> of them, so overall time complexity is <code class="language-plaintext highlighter-rouge">O(n log n)</code>. Space complexity is <code class="language-plaintext highlighter-rouge">O(n)</code>.</p>

<h4 id="code">Code</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">bisect</span> <span class="kn">import</span> <span class="n">bisect</span>

<span class="k">class</span> <span class="nc">Solution</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">expTree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="n">lvl</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">symb</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="n">lvl</span> <span class="o">+=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">symb</span> <span class="o">==</span> <span class="s">"("</span><span class="p">)</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">symb</span> <span class="o">==</span> <span class="s">")"</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">symb</span> <span class="ow">in</span> <span class="s">"+-"</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">lvl</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">symb</span> <span class="ow">in</span> <span class="s">"*/"</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">lvl</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="n">beg</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">beg</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span> <span class="k">return</span> <span class="n">Node</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">beg</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">beg</span> <span class="o">&gt;</span> <span class="n">end</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">bisect</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">level</span><span class="p">],</span> <span class="n">end</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ind</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">level</span><span class="p">][</span><span class="n">ind</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">beg</span><span class="p">:</span>
                    <span class="n">mid</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">level</span><span class="p">][</span><span class="n">ind</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">mid</span><span class="p">])</span>
                    <span class="n">node</span><span class="p">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">calc</span><span class="p">(</span><span class="n">beg</span><span class="p">,</span> <span class="n">mid</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
                    <span class="n">node</span><span class="p">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">calc</span><span class="p">(</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">node</span>
            <span class="k">return</span> <span class="n">calc</span><span class="p">(</span><span class="n">beg</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">end</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">calc</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>


  </div><a class="u-url" href="/leetcode/1597.html" hidden></a>
</article>


      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">Dmitry Babichev</li>
          <li><a class="u-email" href="mailto:dimitry008@gmail.com">dimitry008@gmail.com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>Here you can find solution to some algorithmic problems, at the moment it is mainly leetcode problems.
</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"></ul>
</div>

  </div>

</footer>
</body>

</html>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>