<!DOCTYPE html>
<html lang="en"><head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Leetcode 0432. All O`one Data Structure | Dmitry Babichev’s webpage</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Leetcode 0432. All O`one Data Structure" />
<meta name="author" content="Dmitry Babichev" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Problem statement" />
<meta property="og:description" content="Problem statement" />
<meta property="og:site_name" content="Dmitry Babichev’s webpage" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-09-14T17:34:30+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Leetcode 0432. All O`one Data Structure" />
<script type="application/ld+json">
{"url":"/leetcode/0432.html","@type":"BlogPosting","headline":"Leetcode 0432. All O`one Data Structure","dateModified":"2021-09-14T17:34:30+02:00","datePublished":"2021-09-14T17:34:30+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"/leetcode/0432.html"},"author":{"@type":"Person","name":"Dmitry Babichev"},"description":"Problem statement","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Dmitry Babichev's webpage" />
    






  
  
</head>

    
    <!-- for mathjax support -->
    
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Dmitry Babichev&#39;s webpage</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/leetcode%20problems/">Leetcode problems</a><a class="page-link" href="/coding%20ideas/">Patterns</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <span>[
  
    
    <a href="/tag/hash table"><code class="highligher-rouge"><nobr>hash table</nobr></code>&nbsp;</a>
  
    
    <a href="/tag/linked list"><code class="highligher-rouge"><nobr>linked list</nobr></code>&nbsp;</a>
  
    
    <a href="/tag/design"><code class="highligher-rouge"><nobr>design</nobr></code>&nbsp;</a>
  
]</span>

<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Leetcode 0432. All O`one Data Structure</h1>
    <p class="post-meta"><time class="dt-published" datetime="2021-09-14T17:34:30+02:00" itemprop="datePublished">
        Sep 14, 2021
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h4 id="problem-statement">Problem statement</h4>

<p><a href="https://leetcode.com/problems/all-oone-data-structure/"> <font color="blue">https://leetcode.com/problems/all-oone-data-structure/</font></a></p>

<h4 id="solution">Solution</h4>
<p>Similar idea to problem <strong>0460</strong>. LFU Cache.</p>

<p>We need to keep for each value set of keys, for example if we have original hash table: <code class="language-plaintext highlighter-rouge">"cat": 1, "dog": 2, "bat":1, "rat":3</code>, then our <code class="language-plaintext highlighter-rouge">keys</code> are <code class="language-plaintext highlighter-rouge">1: {"cat", "bat"}, 2: {"dog"}, 3: {"rat"}</code>. We need to keep it as doubly-linked list: data-structure like this:</p>

<p><code class="language-plaintext highlighter-rouge">[self.val, self.keys = set(), self.prev, self.next]</code>.</p>

<p>So, if we remove some value completely, we can rebuild our data in <code class="language-plaintext highlighter-rouge">O(1)</code>. It is easier to say than to implement this. When we increase value, we need to check if our next element in linked list is equal to value + 1 or not and either create new cell in linked list or add element to next cell. Do not forget to delete empty cells. Similar logic when we decreasing keys. To find Min or Max, just look at the first and last cells of our linked list. Good idea also is to use sentinels before head and after tail.</p>

<h4 id="complexity">Complexity</h4>
<p>Complexity of all operations is <code class="language-plaintext highlighter-rouge">O(1)</code>.</p>

<h4 id="code">Code</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ListNode</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">nxt</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">prv</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">val</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="nb">next</span> <span class="o">=</span> <span class="n">nxt</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">prv</span>

<span class="k">class</span> <span class="nc">DoubleLinkedList</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">head</span> <span class="o">=</span> <span class="n">ListNode</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">tail</span> <span class="o">=</span> <span class="n">ListNode</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">head</span><span class="p">.</span><span class="nb">next</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">tail</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">tail</span><span class="p">.</span><span class="n">prev</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">head</span>

    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Node</span><span class="p">,</span> <span class="n">newNode</span><span class="p">):</span>
        <span class="n">newNode</span><span class="p">.</span><span class="nb">next</span> <span class="o">=</span> <span class="n">Node</span><span class="p">.</span><span class="nb">next</span>
        <span class="n">Node</span><span class="p">.</span><span class="nb">next</span><span class="p">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">newNode</span>
        <span class="n">Node</span><span class="p">.</span><span class="nb">next</span> <span class="o">=</span> <span class="n">newNode</span>
        <span class="n">newNode</span><span class="p">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">Node</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">node</span><span class="p">.</span><span class="n">prev</span><span class="p">.</span><span class="nb">next</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="nb">next</span>
        <span class="n">node</span><span class="p">.</span><span class="nb">next</span><span class="p">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">prev</span>

<span class="k">class</span> <span class="nc">AllOne</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">dll</span> <span class="o">=</span> <span class="n">DoubleLinkedList</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># key to node
</span>
    <span class="k">def</span> <span class="nf">inc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">mapping</span><span class="p">:</span>  <span class="c1"># find current node and remove key
</span>            <span class="n">cur_node</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">dll</span><span class="p">.</span><span class="n">head</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cur_node</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">mapping</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">cur_node</span><span class="p">.</span><span class="n">keys</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cur_node</span><span class="p">.</span><span class="n">val</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">!=</span> <span class="n">cur_node</span><span class="p">.</span><span class="nb">next</span><span class="p">.</span><span class="n">val</span><span class="p">:</span>  <span class="c1"># insert new node
</span>            <span class="n">new_node</span> <span class="o">=</span> <span class="n">ListNode</span><span class="p">(</span><span class="n">cur_node</span><span class="p">.</span><span class="n">val</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">dll</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">cur_node</span><span class="p">,</span> <span class="n">new_node</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_node</span> <span class="o">=</span> <span class="n">cur_node</span><span class="p">.</span><span class="nb">next</span>

        <span class="n">new_node</span><span class="p">.</span><span class="n">keys</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>  <span class="c1"># update new_node
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">mapping</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_node</span>  <span class="c1"># ... and mapping of key to new_node
</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cur_node</span><span class="p">.</span><span class="n">keys</span> <span class="ow">and</span> <span class="n">cur_node</span><span class="p">.</span><span class="n">val</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># delete current node if not seninel
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">dll</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">cur_node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">mapping</span><span class="p">:</span> <span class="k">return</span>

        <span class="n">cur_node</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">mapping</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">mapping</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">cur_node</span><span class="p">.</span><span class="n">keys</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cur_node</span><span class="p">.</span><span class="n">val</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cur_node</span><span class="p">.</span><span class="n">val</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">!=</span> <span class="n">cur_node</span><span class="p">.</span><span class="n">prev</span><span class="p">.</span><span class="n">val</span><span class="p">:</span>  <span class="c1"># insert new node
</span>                <span class="n">new_node</span> <span class="o">=</span> <span class="n">ListNode</span><span class="p">(</span><span class="n">cur_node</span><span class="p">.</span><span class="n">val</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">dll</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">cur_node</span><span class="p">.</span><span class="n">prev</span><span class="p">,</span> <span class="n">new_node</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_node</span> <span class="o">=</span> <span class="n">cur_node</span><span class="p">.</span><span class="n">prev</span>
            <span class="n">new_node</span><span class="p">.</span><span class="n">keys</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">mapping</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_node</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">cur_node</span><span class="p">.</span><span class="n">keys</span><span class="p">:</span>  <span class="c1"># delete current node
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">dll</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">cur_node</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">getMaxKey</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">dll</span><span class="p">.</span><span class="n">tail</span><span class="p">.</span><span class="n">prev</span><span class="p">.</span><span class="n">val</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="s">""</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">dll</span><span class="p">.</span><span class="n">tail</span><span class="p">.</span><span class="n">prev</span><span class="p">.</span><span class="n">keys</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">getMinKey</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">dll</span><span class="p">.</span><span class="n">head</span><span class="p">.</span><span class="nb">next</span><span class="p">.</span><span class="n">val</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="s">""</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">dll</span><span class="p">.</span><span class="n">head</span><span class="p">.</span><span class="nb">next</span><span class="p">.</span><span class="n">keys</span><span class="p">))</span>
</code></pre></div></div>

  </div><a class="u-url" href="/leetcode/0432.html" hidden></a>
</article>


      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">Dmitry Babichev</li>
          <li><a class="u-email" href="mailto:dimitry008@gmail.com">dimitry008@gmail.com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>Here you can find solution to some algorithmic problems, at the moment it is mainly leetcode problems.
</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"></ul>
</div>

  </div>

</footer>
</body>

</html>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>