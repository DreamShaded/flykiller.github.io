<!DOCTYPE html>
<html lang="en"><head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Codeforces contest 1626 | Dmitry Babichev’s webpage</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Codeforces contest 1626" />
<meta name="author" content="Dmitry Babichev" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Here you can find solution to some algorithmic problems, at the moment it is mainly leetcode problems." />
<meta property="og:description" content="Here you can find solution to some algorithmic problems, at the moment it is mainly leetcode problems." />
<link rel="canonical" href="http://localhost:4000/codeforces/1626.html" />
<meta property="og:url" content="http://localhost:4000/codeforces/1626.html" />
<meta property="og:site_name" content="Dmitry Babichev’s webpage" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Codeforces contest 1626" />
<script type="application/ld+json">
{"url":"http://localhost:4000/codeforces/1626.html","author":{"@type":"Person","name":"Dmitry Babichev"},"@type":"WebPage","description":"Here you can find solution to some algorithmic problems, at the moment it is mainly leetcode problems.","headline":"Codeforces contest 1626","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Dmitry Babichev&apos;s webpage" />
    






  



<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

</head>

    
    <!-- for mathjax support -->
    
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Dmitry Babichev&#39;s webpage</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/codeforces%20problems/">Codeforces</a><a class="page-link" href="/leetcode/">Leetcode</a><a class="page-link" href="/binarysearch%20problems/">BinarySearch</a><a class="page-link" href="/coding%20ideas/">Patterns</a><a class="page-link" href="/performance%20tricks/">Speed up</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <span>[
  
    
    <a href="/tag/string"><code class="highligher-rouge"><nobr>string</nobr></code>&nbsp;</a>
  
    
    <a href="/tag/greedy"><code class="highligher-rouge"><nobr>greedy</nobr></code>&nbsp;</a>
  
    
    <a href="/tag/math"><code class="highligher-rouge"><nobr>math</nobr></code>&nbsp;</a>
  
    
    <a href="/tag/intervals"><code class="highligher-rouge"><nobr>intervals</nobr></code>&nbsp;</a>
  
    
    <a href="/tag/sort"><code class="highligher-rouge"><nobr>sort</nobr></code>&nbsp;</a>
  
    
    <a href="/tag/dp"><code class="highligher-rouge"><nobr>dp</nobr></code>&nbsp;</a>
  
    
    <a href="/tag/dfs"><code class="highligher-rouge"><nobr>dfs</nobr></code>&nbsp;</a>
  
    
    <a href="/tag/binary search"><code class="highligher-rouge"><nobr>binary search</nobr></code>&nbsp;</a>
  
    
    <a href="/tag/combinatorics"><code class="highligher-rouge"><nobr>combinatorics</nobr></code>&nbsp;</a>
  
]</span>

<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Codeforces contest 1626</h1>
    <p class="post-meta"><time class="dt-published" datetime="" itemprop="datePublished">
        
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h4 id="problem-a-statement">Problem A statement</h4>
<p>[string, greedy]</p>

<p><a href="https://codeforces.com/contest/1626/problem/A"> <font color="blue">https://codeforces.com/contest/1626/problem/A</font></a></p>

<h4 id="solution">Solution</h4>
<p>We just need to calculate all letters and put ones with frequency one in the middle and other in the start and end.</p>

<h4 id="complexity">Complexity</h4>
<p>It is <code class="language-plaintext highlighter-rouge">O(m^2)</code>, where <code class="language-plaintext highlighter-rouge">m</code> is size of alphabet, it can be easily made <code class="language-plaintext highlighter-rouge">O(m)</code>.</p>

<h4 id="code">Code</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">T</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">())</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">input</span><span class="p">().</span><span class="n">rstrip</span><span class="p">()</span>
    <span class="n">pref</span> <span class="o">=</span> <span class="s">""</span>
    <span class="n">mid</span> <span class="o">=</span> <span class="s">""</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="s">"abcdefghijklmnopqrstuvwxyz"</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">s</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">pref</span> <span class="o">+=</span> <span class="n">x</span>
        <span class="k">elif</span> <span class="n">s</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">mid</span> <span class="o">+=</span> <span class="n">x</span>
    <span class="k">print</span><span class="p">(</span><span class="n">pref</span> <span class="o">+</span> <span class="n">mid</span> <span class="o">+</span> <span class="n">pref</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="problem-b-statement">Problem B statement</h4>
<p>[greedy, math]</p>

<p><a href="https://codeforces.com/contest/1626/problem/B"> <font color="blue">https://codeforces.com/contest/1626/problem/B</font></a></p>

<h4 id="solution-1">Solution</h4>
<p>We need to deal with two types of compression: first one with <code class="language-plaintext highlighter-rouge">2</code> digits answer, like <code class="language-plaintext highlighter-rouge">57, 89</code> and another with one digit, like <code class="language-plaintext highlighter-rouge">34, 10</code>.</p>
<ol>
  <li>If we have <code class="language-plaintext highlighter-rouge">2</code> digits compressions, we need to choose the rightest one.</li>
  <li>If we have only <code class="language-plaintext highlighter-rouge">1</code> digits compressions, we need to choose the leftest one.</li>
</ol>

<h4 id="complexity-1">Complexity</h4>
<p>It is <code class="language-plaintext highlighter-rouge">O(n)</code> for time and space.</p>

<h4 id="code-1">Code</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">T</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">())</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">input</span><span class="p">().</span><span class="n">rstrip</span><span class="p">()</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">mx</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[]</span>
 
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">mx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span> <span class="n">sm</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sm</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">d1</span> <span class="o">+=</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d2</span> <span class="o">+=</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span>
 
    <span class="n">t</span> <span class="o">=</span> <span class="n">d2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">mx</span> <span class="o">&gt;=</span> <span class="mi">10</span> <span class="k">else</span> <span class="n">d1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">[:</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">2</span><span class="p">:])</span>
</code></pre></div></div>

<h4 id="problem-c-statement">Problem C statement</h4>
<p>[itervals, sort]</p>

<p><a href="https://codeforces.com/contest/1626/problem/C"> <font color="blue">https://codeforces.com/contest/1626/problem/C</font></a></p>

<h4 id="solution-2">Solution</h4>
<p>Actually this problem is about intervals. Imagine that some <code class="language-plaintext highlighter-rouge">k = 100</code> and <code class="language-plaintext highlighter-rouge">h = 10</code>. Then we need to start to cast spell in moment of time <code class="language-plaintext highlighter-rouge">k - h + 1 = 91</code> till <code class="language-plaintext highlighter-rouge">100</code>, so we have interval <code class="language-plaintext highlighter-rouge">[91, 100]</code>. What happens if two intervals intersect? We need to merge them, there is nothing else we can do, because we allowed to start only from <code class="language-plaintext highlighter-rouge">1</code>. So, create all interval, then merge them and then calculate cost for each of them.</p>

<h4 id="complexity-2">Complexity</h4>
<p>Time complexity is <code class="language-plaintext highlighter-rouge">O(n log n)</code>, where <code class="language-plaintext highlighter-rouge">n</code> is number of monsters.</p>

<h4 id="code-2">Code</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="n">I</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">().</span><span class="n">split</span><span class="p">()]</span>
 
 
<span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">intervals</span><span class="p">):</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="p">[]</span>
 
    <span class="k">for</span> <span class="n">beg</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">intervals</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ans</span> <span class="ow">or</span> <span class="n">ans</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">beg</span><span class="p">:</span>
            <span class="n">ans</span> <span class="o">+=</span> <span class="p">[[</span><span class="n">beg</span><span class="p">,</span> <span class="n">end</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ans</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ans</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">end</span><span class="p">)</span>
 
    <span class="k">return</span> <span class="n">ans</span>
 
<span class="n">T</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">())</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">())</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">I</span><span class="p">()</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">I</span><span class="p">()</span>
    <span class="n">ints</span> <span class="o">=</span> <span class="p">[[</span><span class="n">k</span> <span class="o">-</span> <span class="n">h</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">H</span><span class="p">)]</span>
 
    <span class="n">merged</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">ints</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">sum</span><span class="p">((</span><span class="n">y</span><span class="o">-</span><span class="n">x</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">merged</span><span class="p">))</span>
</code></pre></div></div>

<h4 id="problem-d-statement">Problem D statement</h4>
<p>[binary search, greedy]</p>

<p><a href="https://codeforces.com/contest/1626/problem/D"> <font color="blue">https://codeforces.com/contest/1626/problem/D</font></a></p>

<h4 id="solution-3">Solution</h4>
<p>Let us focus on sizes of ligth and heavy groups. We have not a lot of choices for those groups: <code class="language-plaintext highlighter-rouge">[1, 2, 4, ..., 2^18]</code>, call them <code class="language-plaintext highlighter-rouge">sizes</code>. Now, imagine, that we try to construct groups with <code class="language-plaintext highlighter-rouge">pref = 8</code> and <code class="language-plaintext highlighter-rouge">suff = 16</code>, what we do? We want to make the first group as big as possible with size <code class="language-plaintext highlighter-rouge">&lt;= 8</code> and the last group as big as possible with size <code class="language-plaintext highlighter-rouge">&lt;= 16</code>. For this we will use binary search.
Also we calculate array <code class="language-plaintext highlighter-rouge">cuts</code> it is the places where we can cut.</p>

<h4 id="complexity-3">Complexity</h4>
<p>Time complexiyt is <code class="language-plaintext highlighter-rouge">O(log^3n + n)</code>, space is <code class="language-plaintext highlighter-rouge">O(n)</code>.</p>

<h4 id="code-3">Code</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">bisect</span> <span class="kn">import</span> <span class="n">bisect</span><span class="p">,</span> <span class="n">bisect_left</span>
<span class="n">I</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">().</span><span class="n">split</span><span class="p">()]</span>
 
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">).</span><span class="n">bit_length</span><span class="p">()))</span> <span class="o">-</span> <span class="n">x</span>
 
<span class="n">T</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">())</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">())</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">I</span><span class="p">())</span>
    <span class="n">cuts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="n">n</span><span class="p">]</span>  <span class="c1">#can take -1?
</span>    <span class="n">sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)]</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">n</span>
 
    <span class="k">for</span> <span class="n">pref</span> <span class="ow">in</span> <span class="n">sizes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">suff</span> <span class="ow">in</span> <span class="n">sizes</span><span class="p">:</span>
            <span class="n">s1</span> <span class="o">=</span> <span class="n">cuts</span><span class="p">[</span><span class="n">bisect</span><span class="p">(</span><span class="n">cuts</span><span class="p">,</span> <span class="n">pref</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">s2</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">cuts</span><span class="p">[</span><span class="n">bisect_left</span><span class="p">(</span><span class="n">cuts</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="n">suff</span><span class="p">)]</span>
            <span class="n">s3</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">s1</span> <span class="o">-</span> <span class="n">s2</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">s3</span><span class="p">))</span>
 
    <span class="k">print</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="problem-e-statement">Problem E statement</h4>
<p>[dfs, dp, greedy]</p>

<p><a href="https://codeforces.com/contest/1626/problem/E"> <font color="blue">https://codeforces.com/contest/1626/problem/E</font></a></p>

<h4 id="solution-4">Solution</h4>
<p>Notice, that all paths will have the following form:</p>
<ol>
  <li>If we start to go down the tree, we will always continue go down.</li>
  <li>We can do several steps up, but then from some moment we will always go down.</li>
</ol>

<p>First, let us deal with paths, which go down.</p>

<p>The key idea of this problem is the following: imagine we have node <code class="language-plaintext highlighter-rouge">u</code> and its children <code class="language-plaintext highlighter-rouge">v</code>. Then if we can reach black node from <code class="language-plaintext highlighter-rouge">v</code> and number of black nodes in subtree of <code class="language-plaintext highlighter-rouge">v</code> is <code class="language-plaintext highlighter-rouge">&gt;=2</code> then we can reach black node from <code class="language-plaintext highlighter-rouge">u</code> as well. Indeed, we have at least <code class="language-plaintext highlighter-rouge">2</code> choices to which of these two nodes we move (in fact we move edge <code class="language-plaintext highlighter-rouge">u -&gt; v</code>) and we can avoid repeting moving towards the same black node. However we will deal only with directions <code class="language-plaintext highlighter-rouge">parent -&gt; child</code> in this way.</p>

<ol>
  <li>So, first, we use preorder dfs where we update <code class="language-plaintext highlighter-rouge">ans</code> as well as <code class="language-plaintext highlighter-rouge">cnt[u]</code> is number of black nodes in subtree of <code class="language-plaintext highlighter-rouge">u</code>.</li>
  <li>Also we want to deal with directions <code class="language-plaintext highlighter-rouge">child -&gt; parent</code>. For this we use postorder dfs, where we start to traverse from root and try to move up. We need to choose such order of traversal, that we visit parent of node before we visit node itself. We allowed to move up <code class="language-plaintext highlighter-rouge">v -&gt; u</code> if <code class="language-plaintext highlighter-rouge">tot - cnt[v] &gt;= 2</code> and <code class="language-plaintext highlighter-rouge">ans[u] = 1</code>.</li>
  <li>Finally, in the beginning, we need to put all neibours of black nodes to our <code class="language-plaintext highlighter-rouge">ans</code>, because we can reach them in one step.</li>
</ol>

<p>I think steps 1 and 2 can be merged somehow and make it more elegant, but I am not sure how.</p>

<h4 id="complexity-4">Complexity</h4>
<p>It is <code class="language-plaintext highlighter-rouge">O(n)</code> for time and <code class="language-plaintext highlighter-rouge">O(n)</code> for space. We also use bootstrap for recursion to avoid TLE.</p>

<h4 id="code-4">Code</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span><span class="p">,</span> <span class="n">Counter</span>
<span class="n">I</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">().</span><span class="n">split</span><span class="p">()]</span>
<span class="kn">import</span> <span class="nn">io</span><span class="p">,</span> <span class="n">os</span><span class="p">,</span> <span class="n">sys</span>
<span class="nb">input</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">os</span><span class="p">.</span><span class="n">fstat</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">st_size</span><span class="p">)).</span><span class="n">readline</span>

<span class="c1">################################################
</span><span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">GeneratorType</span>
<span class="k">def</span> <span class="nf">bootstrap</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="p">[]):</span>
    <span class="k">def</span> <span class="nf">wrappedfunc</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">stack</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">to</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">to</span><span class="p">)</span> <span class="ow">is</span> <span class="n">GeneratorType</span><span class="p">:</span>
                    <span class="n">stack</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">to</span><span class="p">)</span>
                    <span class="n">to</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">to</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">stack</span><span class="p">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">stack</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">to</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="n">send</span><span class="p">(</span><span class="n">to</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">to</span>
    <span class="k">return</span> <span class="n">wrappedfunc</span>
<span class="c1">################################################
</span>

<span class="o">@</span><span class="n">bootstrap</span>
<span class="k">def</span> <span class="nf">dfs1</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="n">cnt</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">G</span><span class="p">[</span><span class="n">u</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="n">p</span><span class="p">:</span> <span class="k">continue</span>
        <span class="k">yield</span> <span class="n">dfs1</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
        <span class="n">cnt</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+=</span> <span class="n">cnt</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ans</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="ow">and</span> <span class="n">cnt</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span> <span class="n">ans</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">yield</span>


<span class="o">@</span><span class="n">bootstrap</span>
<span class="k">def</span> <span class="nf">dfs2</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">G</span><span class="p">[</span><span class="n">u</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="n">p</span><span class="p">:</span> <span class="k">continue</span>
        <span class="k">if</span> <span class="n">ans</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="ow">and</span> <span class="n">tot</span> <span class="o">-</span> <span class="n">cnt</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span> <span class="n">ans</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">yield</span> <span class="n">dfs2</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
    <span class="k">yield</span>

<span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">())</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">I</span><span class="p">()</span>
<span class="n">cnt</span><span class="p">,</span> <span class="n">ans</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="n">tot</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">I</span><span class="p">()</span>
    <span class="n">G</span><span class="p">[</span><span class="n">u</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">v</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">G</span><span class="p">[</span><span class="n">v</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">u</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="k">continue</span>
    <span class="n">ans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">G</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">ans</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">dfs1</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">dfs2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">" "</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ans</span><span class="p">))</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="problem-f-statement">Problem F statement</h4>
<p>[dp, math, combinatorics]</p>

<p><a href="https://codeforces.com/contest/1626/problem/F"> <font color="blue">https://codeforces.com/contest/1626/problem/F</font></a></p>

<h4 id="solution-5">Solution</h4>
<p>Nice and difficult problem. Let us first notice, that if we replace number <code class="language-plaintext highlighter-rouge">x</code> with number <code class="language-plaintext highlighter-rouge">y = x % 720720</code>, then we can easily recalculate answer. Why it is so? <code class="language-plaintext highlighter-rouge">N = 720270</code> is number which can be divided by <code class="language-plaintext highlighter-rouge">1, 2, 3, ..., 16</code> without reminder and it means that when we perform some operations with <code class="language-plaintext highlighter-rouge">x</code>: <code class="language-plaintext highlighter-rouge">x -= x % i</code> for all <code class="language-plaintext highlighter-rouge">i</code> in range <code class="language-plaintext highlighter-rouge">1, 2, ..., 16</code> and then apply <code class="language-plaintext highlighter-rouge">% 720702</code> it will be the same as we do this directy with <code class="language-plaintext highlighter-rouge">y</code>. Also instead of expectation we calculate it directly multiplied by <code class="language-plaintext highlighter-rouge">n^k</code> as asked. Imagine, that we have</p>

<p><code class="language-plaintext highlighter-rouge">[x1, x2, ..., xi, xi+1, ..., xn]</code> and we changed it to <code class="language-plaintext highlighter-rouge">[x1, x2, ..., yi = xi % N, xi+1, ..., xn]</code>. What happen with our Expectation? There can be exaclty <code class="language-plaintext highlighter-rouge">n^k</code> options how we genereated random index. For each of these options we have <code class="language-plaintext highlighter-rouge">k</code> terms in sum. There will be <code class="language-plaintext highlighter-rouge">n^{k-1} * k</code> times we meet <code class="language-plaintext highlighter-rouge">xi</code> in this sum. So, when we go from <code class="language-plaintext highlighter-rouge">xi</code> to <code class="language-plaintext highlighter-rouge">yi</code>, we will loose <code class="language-plaintext highlighter-rouge">n^{k-1} * k * (xi - yi)</code>, which we need to add.</p>

<p>No, let us look at numbers <code class="language-plaintext highlighter-rouge">p0, ..., pN</code>: this is how many of each number modulo <code class="language-plaintext highlighter-rouge">N</code> we have. Divided by <code class="language-plaintext highlighter-rouge">n</code> this numbers represent probabilities with which we can choose our numbers. (Imagine that <code class="language-plaintext highlighter-rouge">N = 4</code> and we have <code class="language-plaintext highlighter-rouge">0, 1, 1, 2, 3, 3, 3</code>, then we have probability <code class="language-plaintext highlighter-rouge">1/7, 2/7, 1/7, 3/7</code> to choose numbers <code class="language-plaintext highlighter-rouge">0, 1, 2, 3</code> if we sample uniformly). After each step probabilities will change. For every element <code class="language-plaintext highlighter-rouge">p[j]</code> with probability <code class="language-plaintext highlighter-rouge">1/n</code> it becomes equal to <code class="language-plaintext highlighter-rouge">p[j - j%i]</code> and with probability <code class="language-plaintext highlighter-rouge">(n-1)/n</code> it stays the same. So, what we need to do is to recalculate all elements in <code class="language-plaintext highlighter-rouge">p</code>. Notice, that because we going from <code class="language-plaintext highlighter-rouge">j = 0</code> to <code class="language-plaintext highlighter-rouge">N-1</code>, there will no be collistions. Because what we actually keep not probabilities but scaled ones, we need to evaluate expectation <code class="language-plaintext highlighter-rouge">tot</code> for level <code class="language-plaintext highlighter-rouge">i</code> and then multiply them by coefficient <code class="language-plaintext highlighter-rouge">n^{k-i}</code>.</p>

<h4 id="complexity-5">Complexity</h4>
<p>It is <code class="language-plaintext highlighter-rouge">O(N*k)</code> for time and <code class="language-plaintext highlighter-rouge">O(N)</code> for space. Notice that <code class="language-plaintext highlighter-rouge">N = lcm(1, ..., k)</code>.</p>

<h4 id="code-5">Code</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">M</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">998244353</span><span class="p">,</span> <span class="mi">720720</span><span class="p">,</span> <span class="mi">0</span>
<span class="n">I</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">().</span><span class="n">split</span><span class="p">()]</span>
<span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">N</span>

<span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">U</span> <span class="o">=</span> <span class="n">I</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">p</span><span class="p">[</span><span class="n">a</span> <span class="o">%</span> <span class="n">N</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">res</span> <span class="o">+=</span> <span class="n">a</span> <span class="o">//</span> <span class="n">N</span> <span class="o">*</span> <span class="n">N</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span> <span class="o">%</span> <span class="n">U</span>

<span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">res</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span> <span class="o">*</span> <span class="n">k</span><span class="p">)</span> <span class="o">%</span> <span class="n">M</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">tot</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">))</span> <span class="o">%</span> <span class="n">M</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">%=</span> <span class="n">M</span>
        <span class="n">p</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="n">j</span> <span class="o">%</span> <span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">tmp</span>
    <span class="n">res</span> <span class="o">+=</span> <span class="p">(</span><span class="n">tot</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="n">M</span><span class="p">))</span> <span class="o">%</span> <span class="n">M</span>

<span class="k">print</span><span class="p">(</span><span class="n">res</span> <span class="o">%</span> <span class="n">M</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="remark">Remark</h4>
<p>I should say that this idea is about markov chains.</p>

  </div><a class="u-url" href="/codeforces/1626.html" hidden></a>
</article>


      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">Dmitry Babichev</li>
          <li><a class="u-email" href="mailto:dimitry008@gmail.com">dimitry008@gmail.com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>Here you can find solution to some algorithmic problems, at the moment it is mainly leetcode problems.
</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"></ul>
</div>

  </div>

</footer>
</body><script async src="https://www.googletagmanager.com/gtag/js?id=G-KR1GZKF62P"></script>
<script>
  window['ga-disable-G-KR1GZKF62P'] = window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1";
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-KR1GZKF62P');
</script>
</html>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>