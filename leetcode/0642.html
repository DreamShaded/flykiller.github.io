<!DOCTYPE html>
<html lang="en"><head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Leetcode 0642. Design Search Autocomplete System | Dmitry Babichev’s webpage</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Leetcode 0642. Design Search Autocomplete System" />
<meta name="author" content="Dmitry Babichev" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Problem statement" />
<meta property="og:description" content="Problem statement" />
<meta property="og:site_name" content="Dmitry Babichev’s webpage" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-12-09T21:59:27+03:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Leetcode 0642. Design Search Autocomplete System" />
<script type="application/ld+json">
{"url":"/leetcode/0642.html","@type":"BlogPosting","headline":"Leetcode 0642. Design Search Autocomplete System","dateModified":"2021-12-09T21:59:27+03:00","datePublished":"2021-12-09T21:59:27+03:00","mainEntityOfPage":{"@type":"WebPage","@id":"/leetcode/0642.html"},"author":{"@type":"Person","name":"Dmitry Babichev"},"description":"Problem statement","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Dmitry Babichev's webpage" />
    






  
  
</head>

    
    <!-- for mathjax support -->
    
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Dmitry Babichev&#39;s webpage</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/leetcode%20problems/">Leetcode problems</a><a class="page-link" href="/coding%20ideas/">Patterns</a><a class="page-link" href="/coding%20ideas%202/">Patterns 2</a><a class="page-link" href="/performance%20tricks/">Speed up</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <span>[
  
    
    <a href="/tag/trie"><code class="highligher-rouge"><nobr>trie</nobr></code>&nbsp;</a>
  
    
    <a href="/tag/string"><code class="highligher-rouge"><nobr>string</nobr></code>&nbsp;</a>
  
    
    <a href="/tag/dfs"><code class="highligher-rouge"><nobr>dfs</nobr></code>&nbsp;</a>
  
]</span>

<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Leetcode 0642. Design Search Autocomplete System</h1>
    <p class="post-meta"><time class="dt-published" datetime="2021-12-09T21:59:27+03:00" itemprop="datePublished">
        Dec 9, 2021
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h4 id="problem-statement">Problem statement</h4>

<p><a href="https://leetcode.com/problems/design-search-autocomplete-system/"> <font color="blue">https://leetcode.com/problems/design-search-autocomplete-system/</font></a></p>

<h4 id="solution">Solution</h4>
<p>On possible solution is to use tries, where we have our Trie but also have one more field: set of all possible sentences we can get, if we start from this node, that is set of sentences starting with all upper nodes. It is not very memory efficient, so we can keep indexes of sentences instead and/or keep only 3 of them (not in the code below).</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">init()</code>: we have <code class="language-plaintext highlighter-rouge">buffer</code>, where we keep current building sentence, <code class="language-plaintext highlighter-rouge">stimes</code>: dictionary with frequencies of sentences and <code class="language-plaintext highlighter-rouge">trie</code>: our Trie. When we initialize, we go through all given sentences and their frequencies and add them to Trie, using <code class="language-plaintext highlighter-rouge">addSentence</code> function and also update <code class="language-plaintext highlighter-rouge">stimes</code> dictionary. Also we have <code class="language-plaintext highlighter-rouge">tnode</code>, which is the place of current node we are in now.</li>
  <li><code class="language-plaintext highlighter-rouge">input(c)</code>: we check if we are finishing our sentence. If not, add symbol to buffer and go the children node. Choose <code class="language-plaintext highlighter-rouge">3</code> hottest candidates among all sentences in this node. If symbol is <code class="language-plaintext highlighter-rouge">#</code>, we need to finish, so we update frequency for our buffer, add it to Trie, make buffer empty and return back to the root of our Trie.</li>
  <li><code class="language-plaintext highlighter-rouge">addSentence(sentence)</code>: we start from the root of our Trie, iterate over letters update children dictionary and also update set of sentences.</li>
</ol>

<h4 id="complexity">Complexity</h4>
<p>Time complexity of <code class="language-plaintext highlighter-rouge">addSentence</code> now is <code class="language-plaintext highlighter-rouge">O(m^2)</code> to add sentence of length <code class="language-plaintext highlighter-rouge">m</code>: we add it to <code class="language-plaintext highlighter-rouge">m</code> different nodes. Time complexity of <code class="language-plaintext highlighter-rouge">input</code> now is <code class="language-plaintext highlighter-rouge">O(m^2)</code> as well: because we need to check all set and choose the hottest <code class="language-plaintext highlighter-rouge">3</code> options.</p>

<h4 id="code">Code</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">TrieNode</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sentences</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        
<span class="k">class</span> <span class="nc">Trie</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">TrieNode</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">root</span>
        <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">TrieNode</span><span class="p">())</span>
            <span class="n">node</span><span class="p">.</span><span class="n">sentences</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">AutocompleteSystem</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sentences</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="nb">buffer</span> <span class="o">=</span> <span class="s">""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">stimes</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">trie</span> <span class="o">=</span> <span class="n">Trie</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">stimes</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">trie</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">trie</span><span class="p">.</span><span class="n">root</span>
 
    <span class="k">def</span> <span class="nf">input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s">"#"</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="nb">buffer</span> <span class="o">+=</span> <span class="n">c</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">node</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">node</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">node</span><span class="p">:</span>
                <span class="n">ans</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">node</span><span class="p">.</span><span class="n">sentences</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="p">.</span><span class="n">stimes</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">x</span><span class="p">))[:</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">stimes</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="nb">buffer</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">trie</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="nb">buffer</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="nb">buffer</span> <span class="o">=</span> <span class="s">""</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">trie</span><span class="p">.</span><span class="n">root</span>
        <span class="k">return</span> <span class="n">ans</span>
</code></pre></div></div>


  </div><a class="u-url" href="/leetcode/0642.html" hidden></a>
</article>


      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">Dmitry Babichev</li>
          <li><a class="u-email" href="mailto:dimitry008@gmail.com">dimitry008@gmail.com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>Here you can find solution to some algorithmic problems, at the moment it is mainly leetcode problems.
</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"></ul>
</div>

  </div>

</footer>
</body>

</html>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>